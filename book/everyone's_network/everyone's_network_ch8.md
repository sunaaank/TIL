# 책 <모두의 네트워크> 개념정리
## 8. 네트워크의 전체 흐름 살펴보기
- OSI 모델의 전체 흐름을 이해한다
- 웹에 접속할 때 이루어지는 캡슐화와 역캡슐화를 이해한다

### Lesson32
- 물리계층: 데이터를 전기 신호로 변환하는 데 필요
- 데이터 링크 계층: 랜에서 데이터를 송수신하는 데 필요
- 네트워크 계층: 다른 네트워크에 있는 목적지에 데이터를 전달하는 데 필요
- 전송 계층: 목적지에 데이터를 정확하게 전달하는 데 필요
- 응용 계층(세션 계층과 표현 계층 포함): 애플리케이션 등에서 사용하는 데이터를 송수신하는데 필요

#### 컴퓨터의 웹브라우저에 URL을 입력할 때부터 웹 서버에 도착할 때까지 이루어지는 OSI모델의 캡슐화, 역캡슐화
1. 웹브라우저에 URL 입력 및 전송 -> 캡슐화 시작 (3-way-handshake 이미 완료되어 연결이 확립된 상태)
2. 응용계층에서는 웹서버에 있는 html 데이터를 얻기 위해 HTTP 메세지를 보냄(`GET /index.html HTTP/1.1`)
3. 이 데이터가 전송계층에 전달됨
4. 전송계층에서는 데이터에 TCP 헤더를 붙임(출발지 포트번호-잘 알려진 포트가 아닌 1025번 이상인 포트 중에 무작위로 선택됨, 목적지 포트번호(HTTP프로토콜이므로 80번 포트))
5. 세그먼트(TCP 헤더를 가진 데이터)가 네트워트 계층에 전달됨. 네트워크 계층에서는 세그먼트에 IP헤더를 붙임(출발지 IP 주소, 목적지 IP 주소 추가)
6. IP 패킷(IP헤더가 붙은 세그먼트)를 데이터 링크 계층으로 전달함
7. 데이터 링크 계층에서는 IP 패킷에 `이더넷 헤더`를 추가함
8. 이더넷 프레임(이더넷 헤더가 붙은 IP 패킷)을 물리계층으로 보냄
9. 물리계층에서는 이더넷프레임을 전기신호로 변환해(랜카드 사용) 네트워크로 전송함.

### Lesson33
10.  스위치는 데이터 링크 계층에서 데이터를 전기신호로 변환하여 라우터로 전송함
11. 라우터는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC주소와 자신의 MAC 주소를 비교함. 이때 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행.
12. 다음으로 네트워크 계층에 전달하고, 자신의 라우팅 테이블과 목적지 IP주소를 비교함
13. 현재 출발지의 IP주소를 라우터의 외부 IP주소(WAN측)로 변경 후 데이터 링크 계층으로 전달
14. 데이터 링크 계층에서는 이더넷 헤더와 트레일러를 붙여 물리계층에서 데이터를 전기신호로 변환하여 네트워크로 다른 라우터에 전달함
15. 다른 라우터에서도 앞의 라우터와 동일한 기능을 수행한 뒤 웹 서버로 전달함

### Lesson34
16. 데이터가 전기신호로 웹 서버에 도착하면, 웹 서버는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC주소와 자신의 MAC주소를 비교함. 주소가 같으면 이더넷 헤더와 트레일러를 분리하고 네트워크 계층에 전달함
17. 네트워크 계층에서는 목적지 IP 주소와 웹 서버의 IP 주소가 같은지 확인. 주소가 같으면 IP 헤더를 분리하고 전송 계층에 전달함
18. 전송 계층에서는 목적지 포트번호를 확인하여 어떤 애플리케이션으로 전달해야 하는지 판단하고 TCP 헤더를 분리하여 응용계층에 전달함