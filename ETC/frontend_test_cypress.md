# 프론트엔드 테스트도구: Cypress
> 프론트엔드 테스트를 위해 Cypress라는 것을 처음 사용해보고 신세계를 맛보았다(짜릿해...). 
이 글에서는 아래의 내용을 살펴보고자 한다.
- 백엔드가 아닌 프론트에서도 테스트를 해야 하는 이유는 무엇인지
- 테스트의 장단점은 무엇인지
- 테스트에는 어떤 종류가 있는지
- 다양한 테스트 도구 중 Cypress의 장점은 무엇인지

## 꼭 프론트엔드에서도 테스트를 해야하나요?
### 여러분은 이미 테스트를 하고 있습니다. 
- 무슨 말이냐고요? 프론트엔드에서 JS 코드를 짜고 나서, 콘솔 등을 통해(console.log....) 브라우저에서 의도대로 작동하는지 확인하는 행위 자체가 테스트입니다. 대신, 자동테스트가 아닌 하나하나 클릭하며 검증하는 수동테스트인 것이죠. Postman을 사용해 API를 미리 체크해보는 것도 테스트죠.
- `테스트`란 어플리케이션이 요구 사항에 맞게 동작하는지를 검증하는 행위를 일컫는다. 개발자의 테스트는 "개발자가 작성하는 자동화 테스트"라는 의미로 주로 사용된다.
- 모든 코드와 시나리오를 하나하나 수동테스트로 하는 것이 아닌, 자동으로 검증하고 싶다면 테스트 코드를 짜면 됩니다. 이를 통해, 내 코드가 잘 동작하는지 자신감을 가질 수 있죠.
- 작은 단위의 어플리케이션은 수동으로 테스트를 해도 금새 끝나지만, 어플리케이션에 기능이 많아질수록, 관여하는 사람이 많아질수록 테스트를 수동으로 하는 것은 번거롭고 시간비용이 많이 듭니다. 놓친 테스트가 발생할 가능성도 높아지고요.
- 때문에 많은 프론트엔드 개발자들은 빠르게, 반복적으로 검증가능하고 신뢰가능한 테스트코드를 작성합니다.

### QA가 하는 일 아닌가요? 
- QA(Software Quality Assurance)가 있는 곳은 업무의 일부인 곳도 있지만, 프론트엔드 개발자도 자신의 코드퀄리티에 책임을 지기 위해 수동/자동 테스트하는 과정이 필요합니다. 개발자가 기존 코드를 건들일 때, 어떤 장애가 발생할지 몰라 두려움을 가지기 쉽습니다. 테스트코드가 있으면 어떤 모듈에 영향을 끼치는지 확인할 수 있으므로, 자신감있게 코드를 수정/개선할 수 있습니다.

## 어떨 때 테스트를 하나요?
- DB값을 검증할 때
- 브라우저에서 실제 렌더링된 HTML/CSS 결과를 확인할 때
- 기존 모듈에 새로운 기능을 추가하는/버그를 수정하는 리팩토링 시, 영향을 받는 다른 모듈의 실행결과를 확인할 때
- 배포과정에서 발생한 문제를 확인할 때

## 테스트의 장단점은 무엇인가요?
### 👍 장점
- 사람이 수동으로 하는 반복된 테스트를 자동화하여 비용감소
- 사람보다 신뢰가능함
- 사람보다 빠름
- 비즈니스와 밀접한 연관이 있는 결제 기능 등에서 버그가 발생하는 상황 방지
=> 개발 안정성, 서비스의 신뢰도, 유저경험 향상

### 👎 단점
- 사용자 경험(시각 청각 등 감각적인 요소)에 대한 문제를 찾을 수 없음
- 실제 환경(네트워크, 디바이스)에 따라 달라지는 상황은 자동화하기 어려움
=> 테스트 실행 환경의 예상하지 못한 문제들(네트워크 오류, 프로세스 대기로 인한 타임아웃 등)로 인해 테스트가 가끔 실패하는 일이 발생
- 단위 테스트나 통합 테스트에 비해 테스트의 실행 속도가 느리기 때문에 개발 단계에서 빠른 피드백을 받기가 어려움
- 세부 모듈들이 갖는 다양한 상황들의 조합을 고려해야 하기 때문에 테스트를 작성하기가 쉽지 않음
- 큰 단위의 기능을 작은 기능으로 나누어 테스트할 수가 없기 때문에 필연적으로 테스트 사이에 중복이 발생함
- 유닛 테스트와 달리 코드를 변경하거나 웹의 DOM 속성이 변경되면 테스트 전에 이를 반영해야 하기 때문에 테스트 코드를 유지보수하는 데에도 지속적인 리소스가 소모

## 테스트에는 어떤 종류가 있나요?
개발자의 관점에서는 범위에 따른 구분을 많이 한다
- 단위(Unit) 테스트
- 통합(Integation) 테스트
- E2E(End to End) 테스트
  - 기능(Functional) 테스트
  - 시스템(System) 테스트
  - UI(User Interface) 테스트
- 회귀(Regression) 테스트
- 성능(Performance) 테스트

<low cost & fast-------------high cost & slow--->
유닛테스트 < 서비스 테스트 < UI 테스트

## Cypress가 무엇인가요?
- JavaScript E2E(End to End) Testing Framework
- 단위 테스트, 통합테스트, E2E 테스트 모두 가능함
- 프론트엔드 개발자들이 개발 단계에서 사용하기에 최적화된 도구
- TestCafe와 함께 최근 가장 각광받고 있는 E2E 도구이며, WebDriver와는 다르게 실제 애플리케이션과 테스트 코드를 동일한 브라우저에서 실행하는 방식


### 장점👍
- 브라우저 기반의 GUI를 사용해 테스트 실행 상태를 확인하고 디버깅 가능
- 크롬 브라우저에서 실행되기 때문에, 개발자 도구를 사용해 디버깅 가능.
- 실행된 모든 테스트 명령과 명령이 실행될 때 UI 상태를 스냅샷 형태로 저장
- 전체 테스트 과정을 동영상으로 저장 가능.
- JEST 같은 자바스크립트 기반의 테스팅 프레임워크와 API의 패턴이 거의 같음
- 테스트코드가 JQuery와 비슷한 부분이 많음

### E2E 테스트
- 실제 사용자가 사용하는 것과 같은 조건에서 전체 시스템을 테스트
- 사용자 시나리오를 매크로처럼 스크립트를 작성하여 브라우저 내에서 자동으로 실행하는 방식으로 시물레이션
- API 서버, DB 등의 외부 서비스들을 모두 사용하여 통합된 시스템을 테스트
- 단위/통합 테스트에 비해 작성이 어렵고 실행 속도가 가장 느림
- 문제가 생긴 부분을 정확히 파악하기가 가장 어려움
- 기능(Functional) 테스트와 비슷한 의미로 사용됨

## TDD, BDD라는 게 있던데...?
### TDD (Test-Driven Development) 테스트 주도 개발
- 요구사항에 걸맞는 테스트를 먼저 작성한 뒤, 각 테스트를 통과하기 위한 최소한의 코드를 작성하고 리팩토링하는 프로그래밍 방식
- 모듈 크기를 작게 하고, 모듈간 의존성을 줄임
- 함수 단위 테스트를 권장. 테스트 단위가 매우 작음
=> 코드 자체에 집중한 테스트 코드를 작성하기 때문에, Side Effect를 포함하는 경우가 많고, 이것만으로 비즈니스 요구사항에 따른 로직을 파악하기 어려워짐

### BDD (Behaviour-Driven Development) 행위 주도 개발
- TDD에 기반을 두고 있음
- 테스트 케이스 자체가 비즈니스 요구사항이 되도록 개발하는 방법
- (비개발자와도 대화가능한)시나리오를 기반으로 테스트 케이스를 작성하며, 함수 단위 테스트를 권장하지 않음
- 테스트 대상의 상태 변화를 체크

#### 테스트 시나리오
하나의 시나리오는 Given, When, Then구조를 가지는 것으로 기본패턴을 권장함
- 테스트 대상은 A 상태에서 출발하며(Given) 어떤 상태 변화를 가했을 때(When) 기대하는 상태로 완료되어야 함 (Then)
- `Feature` : 테스트에 대상의 기능/책임을 명시합니다
- `Scenario` : 테스트 목적에 대한 상황을 설명합니다
- `Given` : 시나리오 진행에 필요한 값을 설정합니다.
- `When` : 시나리오를 진행하는데 필요한 조건을 명시합니다
- `Then` : 시나리오를 완료했을 때 보장해야 하는 결과를 명시합니다.


## 참고자료
### 테스트
- [테스트, TOAST UI](https://ui.toast.com/fe-guide/ko_TEST)
- [[시리즈] 프론트엔드 어떻게 테스트할 것인가, Jbee](https://jbee.io/react/testing-2-react-testing/)
- [테스트 주도 개발(TDD와 BDD)](https://yorr.tistory.com/26)
- [BDD (Behaviour-Driven Development)에 대한 간략한 정리](https://www.popit.kr/bdd-behaviour-driven-development%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B0%84%EB%9E%B5%ED%95%9C-%EC%A0%95%EB%A6%AC/)

### Cypress
- [Cypress로 타입스크립트 테스트 환경을 구축한 클래스101](https://class101.dev/ko/blog/2020/06/24/han/)
> #### 목표 
- 결제 기능에 버그가 생기면 비즈니스에 치명적이므로 관련 기능을 지속적으로 테스트한다.
- github 에서의 PR 등을 Webhook Trigger를 이용하면 테스트가 자동으로 가동된다.
- 기존의 배포체계와 연동해 배포가 끝날 때마다 테스트가 가동된다.
- 누구든 원할 때마다 쉽게 테스트를 시작할 수 있다.
- 테스트가 실패했을때 효율적으로 대응하기 위해 Slack과 같은 커뮤니케이션 툴과 연동한다.
- Javascript가 아닌 Typescript로 테스트 코드를 작성한다.
#### 예상 결과
- 상용에 배포하기 전, 테스트에서 버그를 찾아 유저 경험을 개선시킨다.
- 결제 페이지에서 버그를 찾아 매출 손실을 줄인다.
- QA담당자가 UI에서 테스트하는 리소스를 최소화한다.

- [Why Cypress?, Cypress](https://docs.cypress.io/)
- [cypress-io, GitHub](https://github.com/cypress-io/cypress-example-kitchensink/blob/master/Jenkinsfile)
- [Cypress.io를 활용한 리액트 전체 테스트](https://github.com/adhrinae/react-testing-tutorial-kr/blob/master/translations/ch10.md)
- [Cypress를 이용한 E2E Test](https://gogomalibu.tistory.com/138)
